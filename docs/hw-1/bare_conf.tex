
%% bare_conf.tex
%% V1.4b
%% 2015/08/26
%% by Michael Shell
%% See:
%% http://www.michaelshell.org/
%% for current contact information.
%%
%% This is a skeleton file demonstrating the use of IEEEtran.cls
%% (requires IEEEtran.cls version 1.8b or later) with an IEEE
%% conference paper.
%%
%% Support sites:
%% http://www.michaelshell.org/tex/ieeetran/
%% http://www.ctan.org/pkg/ieeetran
%% and
%% http://www.ieee.org/

%%*************************************************************************
%% Legal Notice:
%% This code is offered as-is without any warranty either expressed or
%% implied; without even the implied warranty of MERCHANTABILITY or
%% FITNESS FOR A PARTICULAR PURPOSE! 
%% User assumes all risk.
%% In no event shall the IEEE or any contributor to this code be liable for
%% any damages or losses, including, but not limited to, incidental,
%% consequential, or any other damages, resulting from the use or misuse
%% of any information contained here.
%%
%% All comments are the opinions of their respective authors and are not
%% necessarily endorsed by the IEEE.
%%
%% This work is distributed under the LaTeX Project Public License (LPPL)
%% ( http://www.latex-project.org/ ) version 1.3, and may be freely used,
%% distributed and modified. A copy of the LPPL, version 1.3, is included
%% in the base LaTeX documentation of all distributions of LaTeX released
%% 2003/12/01 or later.
%% Retain all contribution notices and credits.
%% ** Modified files should be clearly indicated as such, including  **
%% ** renaming them and changing author support contact information. **
%%*************************************************************************


% *** Authors should verify (and, if needed, correct) their LaTeX system  ***
% *** with the testflow diagnostic prior to trusting their LaTeX platform ***
% *** with production work. The IEEE's font choices and paper sizes can   ***
% *** trigger bugs that do not appear when using other class files.       ***                          ***
% The testflow support page is at:
% http://www.michaelshell.org/tex/testflow/



\documentclass[conference]{IEEEtran}
% Some Computer Society conferences also require the compsoc mode option,
% but others use the standard conference format.
%
% If IEEEtran.cls has not been installed into the LaTeX system files,
% manually specify the path to it like:
% \documentclass[conference]{../sty/IEEEtran}





% Some very useful LaTeX packages include:
% (uncomment the ones you want to load)


% *** MISC UTILITY PACKAGES ***
%
%\usepackage{ifpdf}
% Heiko Oberdiek's ifpdf.sty is very useful if you need conditional
% compilation based on whether the output is pdf or dvi.
% usage:
% \ifpdf
%   % pdf code
% \else
%   % dvi code
% \fi
% The latest version of ifpdf.sty can be obtained from:
% http://www.ctan.org/pkg/ifpdf
% Also, note that IEEEtran.cls V1.7 and later provides a builtin
% \ifCLASSINFOpdf conditional that works the same way.
% When switching from latex to pdflatex and vice-versa, the compiler may
% have to be run twice to clear warning/error messages.






% *** CITATION PACKAGES ***
%
%\usepackage{cite}
% cite.sty was written by Donald Arseneau
% V1.6 and later of IEEEtran pre-defines the format of the cite.sty package
% \cite{} output to follow that of the IEEE. Loading the cite package will
% result in citation numbers being automatically sorted and properly
% "compressed/ranged". e.g., [1], \cite{seznec2007tage}, \cite{calder1997evidence}, \cite{lee1995branch}, \cite{jimenez2001dynamic}, \cite{jimenez2003fast} without using
% cite.sty will become [1], \cite{calder1997evidence}, \cite{jimenez2001dynamic}--\cite{lee1995branch}, \cite{seznec2007tage} using cite.sty. cite.sty's
% \cite will automatically add leading space, if needed. Use cite.sty's
% noadjust option (cite.sty V3.8 and later) if you want to turn this off
% such as if a citation ever needs to be enclosed in parenthesis.
% cite.sty is already installed on most LaTeX systems. Be sure and use
% version 5.0 (2009-03-20) and later if using hyperref.sty.
% The latest version can be obtained at:
% http://www.ctan.org/pkg/cite
% The documentation is contained in the cite.sty file itself.






% *** GRAPHICS RELATED PACKAGES ***
%
\ifCLASSINFOpdf
  % \usepackage[pdftex]{graphicx}
  % declare the path(s) where your graphic files are
  % \graphicspath{{../pdf/}{../jpeg/}}
  % and their extensions so you won't have to specify these with
  % every instance of \includegraphics
  % \DeclareGraphicsExtensions{.pdf,.jpeg,.png}
\else
  % or other class option (dvipsone, dvipdf, if not using dvips). graphicx
  % will default to the driver specified in the system graphics.cfg if no
  % driver is specified.
  % \usepackage[dvips]{graphicx}
  % declare the path(s) where your graphic files are
  % \graphicspath{{../eps/}}
  % and their extensions so you won't have to specify these with
  % every instance of \includegraphics
  % \DeclareGraphicsExtensions{.eps}
\fi
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{amsmath}
\usepackage{amsmath,amssymb,amsthm,latexsym,paralist, booktabs}
\usepackage{url}
\usepackage[pdftex]{graphicx}
% default pic path
\usepackage{bm}
\usepackage{mathtools}
\let\oldvec\vec
\renewcommand{\vec}[1]{\oldvec{\mathit{#1}}}
\newcommand{\mat}[1]{\mathbf{#1}} % undergraduate algebra version
\newcommand{\parallelsum}{\mathbin{\!/\mkern-5mu/\!}}
\graphicspath{{pics/}}
\usepackage{subfigure}
%\newcommand{\mat}[1]{\bm{\mathit{#1}}}




% *** Do not adjust lengths that control margins, column widths, etc. ***
% *** Do not use packages that alter fonts (such as pslatex).         ***
% There should be no need to do such things with IEEEtran.cls V1.6 and later.
% (Unless specifically asked to do so by the journal or conference you plan
% to submit to, of course. )


% correct bad hyphenation here
\hyphenation{op-tical net-works semi-conduc-tor}


\begin{document}
%
% paper title
% Titles are generally capitalized except for words such as a, an, and, as,
% at, but, by, for, in, nor, of, on, or, the, to and up, which are usually
% not capitalized unless they are the first or last word of the title.
% Linebreaks \\ can be used within to get better formatting as desired.
% Do not put math or special symbols in the title.
\title{CSCE 643 Multi-View Geometry CV\\
Homework I}


% author names and affiliations
% use a multiple column layout for up to three different
% affiliations
\author{\IEEEauthorblockN{Yukun Zeng}
\IEEEauthorblockA{Department of Computer Science and Engineering\\
Texas A\&M University\\
College Station, TX 77840\\
Email: yzeng@tamu.edu}}

% conference papers do not typically use \thanks and this command
% is locked out in conference mode. If really needed, such as for
% the acknowledgment of grants, issue a \IEEEoverridecommandlockouts
% after \documentclass

% for over three affiliations, or if they all won't fit within the width
% of the page, use this alternative format:
% 
%\author{\IEEEauthorblockN{Michael Shell\IEEEauthorrefmark{1},
%Homer Simpson\IEEEauthorrefmark{2},
%James Kirk\IEEEauthorrefmark{3}, 
%Montgomery Scott\IEEEauthorrefmark{3} and
%Eldon Tyrell\IEEEauthorrefmark{4}}
%\IEEEauthorblockA{\IEEEauthorrefmark{1}School of Electrical and Computer Engineering\\
%Georgia Institute of Technology,
%Atlanta, Georgia 30332--0250\\ Email: see http://www.michaelshell.org/contact.html}
%\IEEEauthorblockA{\IEEEauthorrefmark{2}Twentieth Century Fox, Springfield, USA\\
%Email: homer@thesimpsons.com}
%\IEEEauthorblockA{\IEEEauthorrefmark{3}Starfleet Academy, San Francisco, California 96678-2391\\
%Telephone: (800) 555--1212, Fax: (888) 555--1212}
%\IEEEauthorblockA{\IEEEauthorrefmark{4}Tyrell Inc., 123 Replicant Street, Los Angeles, California 90210--4321}}




% use for special paper notices
%\IEEEspecialpapernotice{(Invited Paper)}




% make the title area
\maketitle

% As a general rule, do not put math, special symbols or citations
% in the abstract

% no keywords




% For peer review papers, you can put extra information on the cover
% page as needed:
% \ifCLASSOPTIONpeerreview
% \begin{center} \bfseries EDICS Category: 3-BBND \end{center}
% \fi
%
% For peerreview papers, this IEEEtran command inserts a page break and
% creates the second title. It will be ignored for other modes.
\IEEEpeerreviewmaketitle



\section{Four point rectification}
As we know, the pictures taken by a camera is actually projections of Euclidean prototype of real-world scenarios. Assuming we have a point in the Euclidean space whose homogenized coordinate is $(x, y, z)$, and its counterpart in projective space, or in the picture, is $(x^\prime , y^\prime , z)$. According to the definition of projective transformation, the planar projective transformation can be represented by a non-singular $3\times 3$ matrix:
\begin{equation}
	\begin{pmatrix}
		x^\prime \\
		y^\prime \\
		z^\prime 
	\end{pmatrix}
	=
	\begin{bmatrix}
		h_{11} & h_{12} & h_{13}\\
		h_{21} & h_{22} & h_{23}\\
		h_{31} &  h_{32} & h_{33}
	\end{bmatrix}
	\begin{pmatrix}
		x\\
		y\\
		z
	\end{pmatrix}
\end{equation}

\noindent more briefly as $\mat{x^\prime} = \mat{H} \mat{x}$, this can be further transformed into (note that by default we assume $h_{33} = 1$):
\begin{equation}
	\begin{split}
		x^\prime &= h_{11}x + h_{12}y + h_{13}z\\
		y^\prime &= h_{21}x + h_{22}y + h_{23}z\\
		z^\prime &= h_{31}x + h_{32}y + z
	\end{split}
\end{equation}

\noindent However, this is up scale, and if we go down scale and set $z^\prime = 1, z = 1$, it turns out that it can be transformed through equation 3--5:
\begin{equation}
	\begin{split}
		x^\prime &=\frac{ h_{11}x + h_{12}y + h_{13}}{h_{31}x + h_{32}y + 1}\\
		y^\prime &= \frac{h_{21}x + h_{22}y + h_{23}}{h_{31}x + h_{32}y + 1}
	\end{split}
\end{equation}

\begin{equation}
	\begin{split}
		x^\prime (h_{31}x + h_{32}y + 1) &= h_{11}x + h_{12}y + h_{13}\\
		y^\prime (h_{31}x + h_{32}y + 1)&= h_{21}x + h_{22}y + h_{23}
	\end{split}
\end{equation}

\begin{equation}
	\begin{split}
		x^\prime = h_{11}x + h_{12}y + h_{13} - h_{31}x^\prime x - h_{32}xy\\
		y^\prime = h_{21}x + h_{22}y + h_{23} - h_{31}xy^\prime - h_{32}yy^\prime
	\end{split}
\end{equation}

\noindent which could also be represented by matrix forms:
\begin{equation}
	\begin{split}
		\begin{bmatrix}
			x & y & 1 & 0 & 0 & 0 & -xx^\prime & -yx^\prime & -x^\prime \\
			0 & 0 & 0 & x & y & 1 & -xy^\prime & -yy^\prime & -y^\prime
		\end{bmatrix}
		\begin{bmatrix}
			h_{11} \\
			h_{12} \\
			h_{13} \\
			h_{21} \\
			h_{22} \\
			h_{23} \\
			h_{31} \\
			h_{32} \\
			h_{33}
		\end{bmatrix} = 0
	\end{split}
\end{equation}

\noindent Now, say we have four points whose coordinate in Euclidean space is $(x_1, y_1), (x_2, y_2), (x_3, y_3), (x_4, y_4)$, and their corresponding coordinates in projective space is $(x_1^\prime, y_1^\prime), (x_2^\prime, y_2^\prime), (x_3^\prime, y_3^\prime), (x_4^\prime, y_4^\prime)$, let:
\begin{equation}
	\begin{split}
		p_i &= 
		\begin{pmatrix}
			x_i & y_i & 1 & 0 & 0 & 0 & -x_ix_i^\prime & -y_ix_i^\prime & -x_i^\prime
		\end{pmatrix}\\
		p_i^\prime& = 
		\begin{pmatrix}
			0 & 0 & 0 & x_i & y_i & 1 & -x_iy_i^\prime & -y_iy_i^\prime & -y_i^\prime \\
		\end{pmatrix}
	\end{split}
\end{equation}

\noindent we can then easily scale equation 6 for our current point set:
\begin{equation}
	\begin{split}
		\begin{bmatrix}
			p_1 \\
			p_1^\prime \\
			p_2 \\
			p_2^\prime \\
			p_3 \\
			p_3^\prime \\
			p_4 \\
			p_4^\prime
		\end{bmatrix}
		\begin{bmatrix}
			h_{11} \\
			h_{12} \\
			h_{13} \\
			h_{21} \\
			h_{22} \\
			h_{23} \\
			h_{31} \\
			h_{32} \\
			1
		\end{bmatrix} = 0
	\end{split}
\end{equation}

\noindent Then, we solve the above simultaneous linear equations thereby getting the homograpy $\mat{H}$ and apply the homography on the original picture to rectify it, hereby the question 1 is solved and a review of solution steps is listed as follows:
\begin{enumerate}
	\item Pick up 4 apex points of a rectangle in the picture and get their coordinates.
	\item Acquire the coordinates of those points picked in the actual Euclidean space (as we just want to rectify the image here we just arbitrarily select 4 coordinates that can form a rectangle and ignores things about scales and actual location).
	\item Do reverse homography to get the homography matrix using those coordinates we get.
	\item Apply the homography we get to all points in the picture space and get the rectified image.
\end{enumerate}

To validate our solution, we did several experiments using our four point rectification approach and get the following results, for every result we attached the original image by its side for convenience of comparison. 
\begin{figure*}
  \centering
  \subfigure[Result Using Our Four Point Rectification Approach]{
    \label{four-point-normal-1} %% label for first subfigure
    \includegraphics[width=0.49\linewidth]{four-point-normal-1.jpeg}}
  \subfigure[Result Using findHomography in OpenCV]{
    \label{findhomo-1} %% label for second subfigure
    \includegraphics[width=0.49\linewidth]{findhomo-1.jpeg}}
  \caption{findHomograph vs. Our Approach for Picture 1}
  \label{four-point-comparison-1} %% label for entire figure
\end{figure*}


\section{Affine rectification using parallelism}
The key of using parallel lines in projective space to recover affine properties from images is the infinite line. In the affinity space, the infinite line is a fixed line $l_{\infty} = (0, 0, 1)^T$, however a projective transformation might maps $l_{\infty}$ from the fixed line at infinity to a finite line $l$ on the space after projection. Then, say we have the infinite line $l = (l_1, l_2, l_3)^T$ in a projective space, where $l_3\neq 0$, and the homography of this current projection $\mat{H}$ can be divided as:
\begin{equation}
	\mat{H}=\mat{H}_A\mat{H}_P
\end{equation}
\noindent where $\mat{H}_A$ is the affine homography and the last matrix $\mat{H}_P$ is the homography for transformation from affine space to current projective space:
\begin{equation}
	\mat{H}_P = 
	\begin{bmatrix}
		1 & 0 & 0 \\
		0 & 1 & 0 \\
		l_1 &  l_2 & l_3
	\end{bmatrix}
\end{equation}

\noindent That is to say, the current projective transformation can be decomposed into two parts, one is the transformation to affine space and the other one is the transformation from affinity to current projective space, and the later one can be directly calculated if the infinite line is given.

Now that we figured out the infinite line could help us back to affinity, we can start to work on the details to calculate the infinite line. We know that in Euclidean space, two parallel line will intersect at an ideal point on infinite line, and if we can get two ideal points then we can easily calculate the infinite line as two points determine a line. Intuitively, we can identify two pairs of parallel lines from the distorted picture and calculate two ideal points through them to form the infinite line and then we can get back to affinity based on our discussion above.

Suppose we have four points $p_1, p_2, p_3, p_4$ and they form a rectangle similar to what we have in question 1, through those we can simply get two pairs of parallel lines:
\begin{equation}
\begin{split}
	\vec{l}_1 = p_1 \times p_2\\
	\vec{l}_2 = p_3 \times p_4\\
	\vec{m}_1 = p_1 \times p_3\\
	\vec{m}_2 = p_2 \times p_4
\end{split}
\end{equation}

\noindent in which we have $l_1\parallelsum l_2$ and $m_1\parallelsum m_2$. Through those pairs of parallel lines, we can further compute two points at the infinite line as follows:
\begin{equation}
\begin{split}
	v_1 &= \vec{l}_1\times \vec{l}_2\\
	v_2 &= \vec{m}_1 \times \vec{m}_2
\end{split}
\end{equation}

\noindent And finally we can acquire the line at infinity $\vec{l}_{\infty} = (l_1, l_2, l_3)$ which can be calculated by:
\begin{equation}
	\vec{l}_{\infty} = v_1 \times v_2
\end{equation}

\noindent According to our discussion above, now we can form a new matrix same as given in equation 10 based on the infinite line, and the new $\mat{H}_P$ can handle the transformation between the picture space and affinity.

To summarize, the following steps are needed when we are doing the affine rectification:
\begin{enumerate}
	\item Find two physically parallel line pairs in the picture plane. (here we can simply use those points we picked for the rectangle in our first question, since those four apexes naturally provide two parallel line pairs)
	\item Through those parallel lines we got, solve two intercepts of those parallel lines in picture plane, which are ideal points that should lie on the line of infinity in the world plane.
	\item From the two ideal points we can now get line of infinity in the picture plane.
	\item Since we know the coordinates of infinite line in the world plane, we can now solve the homography transformation from picture plane to affinity.
\end{enumerate}

\section{From Affinity to normal: a two step approach}
Now that we have got the image $\mat{I}_A$ that is affinely rectified (1st step), we can further remove the affine distortion from it (step 2) through using $C_{\infty}^*$, basically to find the $\mat{H}_A$ in equation 9 so that:
\begin{equation}
	\mat{H}_A = \begin{bmatrix}
		A & \vec{t} \\
		\vec{0} & 1
	\end{bmatrix}
\end{equation}
and if we apply $\mat{H}_A$ on the affinely rectified image we can get the real-world image:
\begin{equation}
	\mat{I}_{real} = \mat{H}_A\mat{I}_A
\end{equation} 

\noindent To solve $\mat{H}_A$, suppose we have two orthogonal lines on the world plane $\vec{l}\bot \vec{m}$, where $\vec{l} = (l_1, l_2, l_3), \vec{m} = (m_1, m_2, m_3)$, and $\vec{l^\prime} = (l_1^\prime, l_2^\prime, l_3^\prime), \vec{m^\prime} = (m_1^\prime, m_2^\prime, m_3^\prime)$ are the two projected lines in the affine plane. If we do a dehomogenization for $\vec{l}, \vec{m}$, we have:
\begin{equation}
\begin{split}
	\vec{l} &= (l_1/l_3, l_2/l_3)\\
	\vec{m} &= (m_1/m_3, m_2/m_3)
\end{split}
\end{equation}
After which we can use the orthogonality so that we have:
\begin{equation}
\begin{split}
	(l_1/l_3, l_2/l_3)(m_1/m_3, m_2/m_3)^T &= 0\\
	\Leftrightarrow l_1m_1+l_2m_2 &= 0
\end{split}
\end{equation}

\noindent Now we introduce the dual degenerate conic:
\begin{equation}
	C^*_{\infty} =
	\begin{pmatrix}
		1 & 0 & 0\\
		0 & 1 & 0\\
		0 & 0 & 0
	\end{pmatrix}
\end{equation}

\noindent So that we have:
\begin{equation}
	l_1m_1 + l_2m_2 = \vec{l}^T C^*_{\infty} \vec{m} = 0
\end{equation}

\noindent Since we know the fact that:
\begin{equation}
	\begin{split}
	\vec{l}^T &= \vec{l^\prime}^TH_{A}\\
	\vec{m} &= H_{A}^T\vec{m^\prime}
	\end{split}
\end{equation}

\noindent we can transform equation 19 to:
\begin{equation}
	\begin{split}
		\vec{l}^T C^*_{\infty} \vec{m} &= \vec{l^\prime}^TH_{A}C_{\infty}^*H_A^T\vec{m^\prime}\\
		&= \vec{l^\prime}^T
		\begin{pmatrix}
			A & \vec{t}\\
			\vec{0} & 1
		\end{pmatrix}
		\begin{pmatrix}
			\vec{I} & \vec{0}\\
			\vec{0} & \vec{1}
		\end{pmatrix}
		\begin{pmatrix}
			A^T & \vec{0}\\
			\vec{t}^T & 1
		\end{pmatrix}
		\vec{m^\prime}\\
		& = \vec{l^\prime}^T
		\begin{pmatrix}
			AA^T & \vec{0}\\
			\vec{0} & 0
		\end{pmatrix}
		\vec{m^\prime}
	\end{split}
\end{equation}


\noindent If we plug $\vec{l^\prime} = (l_1^\prime, l_2^\prime, l_3^\prime), \vec{m^\prime} = (m_1^\prime, m_2^\prime, m_3^\prime)$ into equation 21 we will have:
\begin{equation}
	(l_1^\prime, l_2^\prime)AA^T(m_1^\prime, m_2^\prime)^T = 0
\end{equation}


% conference papers do not normally have an appendix


% use section* for acknowledgment





% trigger a \newpage just before the given reference
% number - used to balance the columns on the last page
% adjust value as needed - may need to be readjusted if
% the document is modified later
%\IEEEtriggeratref{8}
% The "triggered" command can be changed if desired:
%\IEEEtriggercmd{\enlargethispage{-5in}}

% references section

% can use a bibliography generated by BibTeX as a .bbl file
% BibTeX documentation can be easily obtained at:
% http://mirror.ctan.org/biblio/bibtex/contrib/doc/
% The IEEEtran BibTeX style support page is at:
% http://www.michaelshell.org/tex/ieeetran/bibtex/
%\bibliographystyle{IEEEtran}
% argument is your BibTeX string definitions and bibliography database(s)
%\bibliography{IEEEabrv,../bib/paper}
%
% <OR> manually copy in the resultant .bbl file
% set second argument of \begin to the number of references
% (used to reserve space for the reference number labels box)
\bibliographystyle{IEEEtran}
% argument is your BibTeX string definitions and bibliography database(s)
\bibliography{refs}




% that's all folks
\end{document}


